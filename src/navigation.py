#!/usr/bin/env python3
import pandas as pd
import rospy
import math
from nav_msgs.msg import Odometry
from std_msgs.msg import Float64, String, Int32
import numpy as np
import ast
from rospkg import RosPack

#from shell_av_ros_msgs.msg import Score
#from shell_simulation.msg import Score

xy_list=[[-173.9965362548828,4.064766883850098],
[-176.0457000732422,4.141112804412842],
[-178.29898071289062,4.454896450042725],
[-180.2538452148437,5.069334983825684],
[-181.96188354492188,5.90751314163208],
[-183.549057006836,7.026302814483643],
[-184.72369384765625,8.138031005859375],
[-186.3819732666016,10.33089828491211],
[-187.4626007080078,12.635811805725098],
[-187.81837463378903,14.004678726196287],
[-188.0668487548828,16.239320755004883],
[-188.09762573242188,18.94306182861328],
[-188.11708068847656,21.480037689208984],
[-188.12088012695312,25.534130096435547],
[-188.0834503173828,29.817062377929688],
[-187.98524475097656,36.08987045288086],
[-187.85958862304688,43.67369842529297],
[-187.88546752929688,51.19533920288086],
[-187.9767303466797,57.17672729492188],
[-188.0314483642578,60.787109375],
[-188.06817626953125,63.66136932373047],
[-188.09957885742188,66.59313201904297],
[-188.1286163330078,69.93208312988281],
[-188.15359497070312,73.87023162841797],
[-188.1139373779297,76.26091003417969],
[-187.8162384033203,78.1406021118164],
[-186.8131561279297,80.86321258544922],
[-185.16452026367188,83.32649230957031],
[-182.46847534179688,85.6349105834961],
[-180.2564849853516,86.70490264892578],
[-178.40005493164062,87.21880340576172],
[-175.7961883544922,87.51874542236328],
[-172.9935302734375,87.58458709716797],
[-169.34230041503906,87.66504669189453],
[-166.2593536376953,87.67919921875],
[-162.22970581054688,87.69120788574219],
[-157.98130798339844,87.70779418945312],
[-153.39089965820312,87.7762222290039],
[-148.8567657470703,87.8709716796875],
[-144.12213134765625,87.95211791992188],
[-140.8170623779297,88.09208679199219],
[-138.5967254638672,88.40685272216797],
[-135.53128051757812,89.23552703857422],
[-133.14720153808594,90.25827026367188],
[-131.03738403320312,91.5310516357422],
[-129.8195343017578,92.46756744384766],
[-128.122802734375,94.08934020996094],
[-126.47915649414062,96.13288879394533],
[-125.21884155273438,98.1743621826172],
[-124.34435272216795,100.03826904296876],
[-123.6684799194336,102.065185546875],
[-123.20449829101562,104.36534118652344],
[-123.0466537475586,106.25637817382812],
[-123.05389404296876,107.90999603271484],
[-123.22499084472656,110.25242614746094],
[-123.4710922241211,113.37863159179688],
[-123.69019317626952,116.810302734375],
[-123.88917541503906,120.61583709716795],
[-124.06867980957033,124.61970520019533],
[-124.2550048828125,127.34905242919922],
[-124.76343536376952,130.79359436035156],
[-125.6531982421875,133.60494995117188],
[-126.9138641357422,135.97103881835938],
[-128.41390991210938,137.89137268066406],
[-130.4533233642578,139.73524475097656],
[-132.52053833007812,141.07839965820312],
[-134.69480895996094,142.08631896972656],
[-137.37619018554688,142.86386108398438],
[-139.8216094970703,143.17807006835938],
[-142.16091918945312,143.21604919433594],
[-145.8414306640625,143.12103271484375],
[-151.62852478027344,143.00306701660156],
[-157.8253936767578,142.83897399902344],
[-163.4443359375,142.47564697265625],
[-169.2858123779297,141.57493591308594],
[-173.45570373535156,140.28598022460938],
[-178.58721923828125,137.5666046142578],
[-182.28106689453125,134.55104064941406],
[-185.1022186279297,131.30506896972656],
[-187.331298828125,127.76951599121094],
[-189.1205291748047,123.7446060180664],
[-190.35739135742188,119.57064056396484],
[-190.98892211914065,115.90943908691406],
[-191.28428649902344,111.37178802490234],
[-191.316635131836,107.12677764892578],
[-191.8316192626953,102.2634048461914],
[-192.6492919921875,99.4866714477539],
[-193.91461181640625,97.19639587402344],
[-195.6024627685547,95.31004333496094],
[-197.14093017578125,94.15718841552734],
[-199.48123168945312,93.02891540527344],
[-202.27294921875,92.28936004638672],
[-205.926986694336,92.00760650634766],
[-210.0306396484375,92.24215698242188],
[-213.42507934570312,92.4469223022461],
[-217.3733673095703,92.57656860351562],
[-222.35968017578125,92.60514068603516],
[-228.3495330810547,92.48141479492188],
[-233.2515411376953,92.27114868164062],
[-237.6016540527344,91.9354248046875],
[-242.76736450195312,91.09211730957033],
[-247.32296752929688,89.89851379394531],
[-250.04904174804688,88.90119934082031],
[-253.14260864257807,87.45113372802734],
[-256.27020263671875,85.59718322753906],
[-258.6217346191406,83.91561126708984],
[-261.27850341796875,81.63270568847656],
[-263.2408447265625,79.61408233642578],
[-265.1945495605469,77.22980499267578],
[-267.0470886230469,74.48632049560547],
[-268.6329040527344,71.56961059570312],
[-269.9241943359375,68.53446197509766],
[-270.9220275878906,65.39698028564453],
[-271.6200866699219,62.30846405029297],
[-272.0555114746094,59.23796844482422],
[-272.2449951171875,56.072147369384766],
[-272.2716064453125,52.855751037597656],
[-272.2510070800781,49.66990280151367],
[-272.2110595703125,46.51592254638672],
[-272.160400390625,43.62124252319336],
[-272.146484375,40.25761795043945],
[-272.1513366699219,36.69939041137695],
[-272.1502380371094,33.8575325012207],
[-272.1454772949219,30.573619842529297],
[-272.1526794433594,26.688138961791992],
[-272.15972900390625,22.446008682250977],
[-272.1753845214844,17.4827823638916],
[-272.2011413574219,12.408084869384766],
[-272.27252197265625,6.13928747177124],
[-272.3669128417969,-0.4430267512798309],
[-272.4889831542969,-6.916098594665527],
[-272.59625244140625,-13.74289608001709],
[-272.6697082519531,-21.02006149291992],
[-272.7015686035156,-27.82993507385254],
[-272.70489501953125,-32.81256103515625],
[-272.69012451171875,-38.083621978759766],
[-272.65399169921875,-43.61142349243164],
[-272.5936584472656,-49.44292068481445],
[-272.5122985839844,-55.19056701660156],
[-272.40020751953125,-61.38684844970703],
[-272.2491455078125,-66.99224853515625],
[-271.7406921386719,-72.11373901367188],
[-270.31072998046875,-76.90848541259766],
[-268.42681884765625,-80.59796905517578],
[-266.4731750488281,-83.18223571777344],
[-264.1402587890625,-85.41517639160156],
[-261.3267517089844,-87.3235855102539],
[-257.9398193359375,-88.836181640625],
[-254.56317138671875,-89.71294403076172],
[-250.1866607666016,-90.40460968017578],
[-246.7471618652344,-90.82320404052734],
[-242.4545135498047,-91.19672393798828],
[-238.7323608398437,-91.40836334228516],
[-235.5289764404297,-91.48555755615234],
[-231.51171875,-91.53086853027344],
[-228.23426818847656,-91.52574920654295],
[-224.731185913086,-91.48243713378906],
[-220.540771484375,-91.40288543701172],
[-216.136947631836,-91.35616302490234],
[-212.2420196533203,-91.34903717041016],
[-208.74929809570312,-91.52800750732422],
[-206.0720672607422,-91.92332458496094],
[-203.00059509277344,-92.79659271240234],
[-200.2578887939453,-94.07379913330078],
[-198.05398559570312,-95.60564422607422],
[-196.31500244140625,-97.28384399414062],
[-194.61529541015625,-99.61901092529295],
[-193.33786010742188,-102.36734771728516],
[-192.59719848632807,-105.38965606689452],
[-192.2893829345703,-108.41578674316406],
[-192.0943298339844,-112.04405975341795],
[-191.93435668945312,-116.42718505859376],
[-191.7547149658203,-120.3287353515625],
[-191.43746948242188,-124.41661071777344],
[-190.90884399414065,-127.9576644897461],
[-190.0545654296875,-131.74281311035156],
[-189.00048828125,-135.08673095703125],
[-187.7306365966797,-138.0673828125],
[-185.9833221435547,-140.94715881347656],
[-184.13804626464844,-143.17494201660156],
[-182.2751007080078,-144.95823669433594],
[-179.60292053222656,-146.98866271972656],
[-176.5097198486328,-148.87258911132812],
[-173.8376922607422,-150.20123291015625],
[-170.7471466064453,-151.42333984375],
[-168.1229248046875,-152.22711181640625],
[-165.4876708984375,-152.89486694335938],
[-162.2599639892578,-153.53665161132812],
[-158.59115600585938,-153.98622131347656],
[-154.42417907714844,-154.2013702392578],
[-150.1721649169922,-154.22488403320312],
[-145.94595336914062,-154.21115112304688],
[-142.31179809570312,-154.206787109375],
[-138.51869201660156,-154.2451171875],
[-134.04983520507812,-154.26841735839844],
[-130.77967834472656,-154.3666534423828],
[-126.45814514160156,-154.60409545898438],
[-123.24394989013672,-154.80882263183594],
[-120.42243957519533,-154.91098022460938],
[-116.29251861572266,-154.92079162597656],
[-112.06920623779295,-154.85623168945312],
[-107.10995483398438,-154.7528076171875],
[-101.50749969482422,-154.63694763183594],
[-95.77971649169922,-154.55267333984375],
[-91.0038070678711,-154.4049835205078],
[-86.796142578125,-154.11813354492188],
[-83.34207153320312,-153.73414611816406],
[-79.5811767578125,-153.10362243652344],
[-75.7611083984375,-152.1875],
[-71.99700164794922,-150.98104858398438],
[-68.87779235839844,-149.71560668945312],
[-65.35102844238281,-147.88784790039062],
[-62.42341995239258,-145.98741149902344],
[-59.68609237670898,-143.82237243652344],
[-57.17939758300781,-141.45767211914062],
[-55.08391952514648,-139.19017028808594],
[-53.11341857910156,-136.76174926757812],
[-51.02161407470703,-133.66928100585938],
[-49.49263000488281,-130.92913818359375],
[-48.00679016113281,-127.8074951171875],
[-46.85873031616211,-124.93572235107422],
[-45.57841110229492,-120.85499572753906],
[-44.77033615112305,-117.17809295654295],
[-44.228660583496094,-112.91735076904295],
[-44.069705963134766,-107.65921020507812],
[-44.08499526977539,-102.30511474609376],
[-44.07776641845703,-96.97398376464844],
[-44.07612609863281,-92.86073303222656],
[-44.1050910949707,-87.13291931152344],
[-44.12180709838867,-79.89187622070312],
[-44.11466217041016,-73.00053405761719],
[-44.08930587768555,-66.83736419677734],
[-44.03279876708984,-58.947513580322266],
[-43.99736404418945,-53.25074005126953],
[-43.97309494018555,-47.31169891357422],
[-43.95694351196289,-43.04436874389648],
[-43.94564056396485,-40.02981185913086],
[-43.929481506347656,-35.66875076293945],
[-43.92024993896485,-33.15398025512695],
[-43.91286087036133,-31.128604888916016],
[-43.90496444702149,-28.94334983825684],
[-43.89666748046875,-26.626771926879883],
[-43.88892364501953,-23.69824981689453],
[-43.8898811340332,-20.65527534484864],
[-43.89898681640625,-17.16086196899414],
[-43.87041473388672,-15.664539337158203],
[-43.78777694702149,-14.228181838989258],
[-43.39543533325195,-11.904111862182615],
[-42.78019332885742,-10.147369384765623],
[-41.91022872924805,-8.572670936584473],
[-41.036014556884766,-7.446054458618164],
[-39.82892990112305,-6.283697605133057],
[-38.11963272094727,-5.124372959136963],
[-36.12406539916992,-4.217715263366699],
[-34.02749252319336,-3.580540180206299],
[-31.75376319885254,-3.1825473308563232],
[-28.69809532165528,-2.908449411392212],
[-25.47432518005371,-2.802196979522705],
[-22.56644630432129,-2.83625602722168],
[-19.20962905883789,-2.8881306648254395],
[-15.651397705078123,-2.9586174488067627],
[-12.358960151672363,-3.082972764968872],
[-9.177200317382812,-3.169743299484253],
[-5.779922962188721,-3.1650402545928955],
[-2.6900768280029297,-3.1240594387054443],
[0.7449410557746887,-3.060570240020752],
[4.630714416503906,-2.968247890472412],
[8.831853866577148,-2.863586902618408],
[15.908442497253418,-2.6748619079589844],
[22.498125076293945,-2.498359441757202],
[30.440013885498047,-2.277181386947632],
[37.62144470214844,-2.1468489170074463],
[44.685428619384766,-2.105672836303711],
[51.48605346679688,-2.098598003387451],
[57.02603530883789,-2.072160243988037],
[61.25225067138672,-2.0584588050842285],
[63.40652847290039,-2.05474853515625],
[67.78711700439453,-2.054908514022827],
[71.9327392578125,-2.06433629989624],
[76.53750610351562,-2.085686445236206],
[82.96109008789062,-2.156552314758301],
[88.80260467529297,-2.2253167629241943],
[93.2630615234375,-2.155611276626587],
[96.15373992919922,-1.6987860202789309],
[97.5695571899414,-1.226886749267578],
[99.840576171875,-0.0493915081024169],
[101.81063079833984,1.5218732357025146],
[103.44778442382812,3.4453396797180176],
[104.76260375976562,5.816763401031494],
[105.5247802734375,8.101513862609863],
[106.02163696289062,10.782010078430176],
[106.27564239501952,13.661499977111816],
[106.36489868164062,16.31073760986328],
[106.4591064453125,21.32739448547364],
[106.5060806274414,26.644004821777344],
[106.56392669677734,33.22188949584961],
[106.60636138916016,39.76375579833984],
[106.34111785888672,47.28271484375],
[105.1490707397461,54.855018615722656],
[103.54646301269533,60.52109909057617],
[101.37678527832033,65.8570785522461],
[99.39836883544922,69.63790893554688],
[97.3860855102539,72.86272430419922],
[95.22710418701172,75.84095764160156],
[92.8371353149414,78.70183563232422],
[90.53809356689452,81.09413146972656],
[88.18342590332031,83.24384307861328],
[85.75520324707031,85.19175720214844],
[83.26280975341797,86.94204711914062],
[80.64724731445312,88.52796936035156],
[78.10895538330078,89.85215759277344],
[75.0589599609375,91.18614196777344],
[71.81037902832031,92.32394409179688],
[67.69982147216797,93.38002014160156],
[63.596317291259766,94.04251861572266],
[58.882904052734375,94.35240173339844],
[55.30605697631836,94.29560089111328],
[53.12079620361328,94.1978759765625],
[51.72505187988281,94.16423797607422],
[49.7562141418457,94.14292907714844],
[46.47654342651367,94.18582916259766],
[44.26419448852539,94.34156799316406],
[42.642333984375,94.65115356445312],
[41.0166244506836,95.24746704101562],
[39.27533721923828,96.27162170410156],
[37.55860900878906,97.8357925415039],
[36.30752182006836,99.59020233154295],
[35.300777435302734,101.96307373046876],
[34.793312072753906,104.35496520996094],
[34.61762237548828,106.98577117919922],
[34.6920051574707,110.01656341552734],
[34.96766662597656,113.95697784423828],
[35.16170883178711,117.51626586914062],
[35.237430572509766,121.3543701171875],
[35.309959411621094,125.80368041992188],
[35.495784759521484,130.185546875],
[35.670021057128906,132.6429901123047],
[35.94970703125,134.85792541503906],
[36.305419921875,136.41615295410156],
[36.61177062988281,137.35400390625],
[37.30698013305664,138.94259643554688],
[38.01803970336914,140.18763732910156],
[38.52201461791992,140.92381286621094],
[38.94673538208008,141.47738647460938],
[39.24286651611328,141.83314514160156],
[39.6784553527832,142.32131958007812],
[40.39847183227539,143.04278564453125],
[41.06871795654297,143.63121032714844],
[41.52227020263672,143.9907684326172],
[41.95270919799805,144.30455017089844],
[42.30813217163086,144.5417022705078],
[42.66464614868164,144.75994873046875],
[42.97100830078125,144.92723083496094],
[43.31366729736328,145.09197998046875],
[43.76252365112305,145.2841339111328],
[43.9505500793457,145.35694885253906],
[43.86225891113281,145.33970642089844],
[44.17808151245117,145.464111328125],
[44.56676483154297,145.58653259277344],
[44.8681869506836,145.6681365966797],
[44.95019912719727,145.68968200683594],
[45.18356704711914,145.74510192871094],
[45.760833740234375,145.8606719970703],
[45.95383834838867,145.89219665527344],
[46.22438430786133,145.92823791503906],
[46.49503326416016,145.94911193847656],
[46.56918716430664,145.94863891601562],
[46.80531311035156,145.9235382080078],
[47.21516799926758,145.88314819335938],
[47.66812515258789,145.87261962890625],
[48.27488708496094,145.8339080810547],
[49.21358108520508,145.77015686035156],
[50.29560089111328,145.7250518798828],
[51.55574035644531,145.66946411132812],
[52.7194709777832,145.62286376953125],
[54.578163146972656,145.5348358154297],
[56.76692199707031,145.44622802734375],
[59.888484954833984,145.3098907470703],
[63.2569580078125,145.18051147460938],
[66.65166473388672,145.03582763671875],
[70.71424865722656,144.84291076660156],
[74.02471923828125,144.66790771484375],
[77.30599212646484,144.46580505371094],
[80.98381805419922,144.20013427734375],
[84.66993713378906,143.90078735351562],
[88.73350524902344,143.53884887695312],
[92.94563293457033,143.07015991210938],
[97.49649810791016,142.41468811035156],
[98.04141235351562,142.32598876953125],
[101.89775848388672,141.63511657714844],
[105.34434509277344,140.94154357910156],
[109.14630889892578,140.09336853027344],
[113.11957550048828,139.06504821777344],
[117.27180480957033,137.7303924560547],
[119.99446868896484,136.73141479492188],
[122.89205932617188,135.49729919433594],
[125.2370834350586,134.41290283203125],
[128.16665649414062,132.8930206298828],
[130.76707458496094,131.312744140625],
[133.76194763183594,129.18458557128906],
[136.4354705810547,127.00205993652344],
[139.10052490234375,124.51829528808594],
[141.21531677246094,122.24600982666016],
[143.18052673339844,119.84098052978516],
[144.8076934814453,117.6112060546875],
[146.2277374267578,115.44499969482422],
[147.46763610839844,113.32830810546876],
[148.41590881347656,111.39891052246094],
[149.0363311767578,109.86482238769533],
[149.58409118652344,108.27155303955078],
[150.18919372558594,106.0536117553711],
[150.60519409179688,103.93936157226562],
[150.91493225097656,101.29645538330078],
[151.054443359375,98.87974548339844],
[151.17880249023438,96.13382720947266],
[151.2626190185547,93.3659439086914],
[151.30113220214844,90.44429779052734],
[151.37098693847656,87.11956787109375],
[151.39927673339844,84.60881042480469],
[151.4181671142578,81.76000213623047],
[151.4508819580078,78.9100341796875],
[151.49461364746094,75.79143524169922],
[151.57167053222656,72.34357452392578],
[151.6518096923828,69.15731048583984],
[151.71881103515625,65.68229675292969],
[151.7399139404297,63.89720153808594],
[151.74252319335938,60.61226272583008],
[151.71539306640625,57.56513595581055],
[151.6790313720703,54.05492401123047],
[151.63717651367188,49.705848693847656],
[151.6190948486328,46.82210922241211],
[151.608642578125,43.62166595458984],
[151.62167358398438,40.16975021362305],
[151.65628051757812,37.21531295776367],
[151.69688415527344,33.44804382324219],
[151.7227325439453,30.707408905029297],
[151.74813842773438,27.015453338623047],
[151.7495574951172,24.213605880737305],
[151.74952697753906,21.926427841186523],
[151.7438201904297,20.62188148498535],
[151.74195861816406,20.08186149597168],
[151.73040771484375,18.37373924255371],
[151.72296142578125,15.870028495788574],
[151.68714904785156,12.993328094482422],
[151.63328552246094,11.200894355773926],
[151.53280639648438,9.985236167907717],
[151.2782745361328,8.268412590026855],
[151.0169677734375,7.331227302551269],
[150.60061645507812,6.528646469116211],
[149.888916015625,5.634683132171631],
[149.03118896484375,4.898694515228272],
[148.2550048828125,4.335596561431885],
[147.53854370117188,3.916996479034424],
[146.87649536132812,3.6034927368164062],
[146.00125122070312,3.2384190559387207],
[145.02938842773438,2.8998055458068848],
[143.8097686767578,2.5686068534851074],
[142.6350860595703,2.327463865280152],
[141.296142578125,2.181244134902954],
[140.60592651367188,2.1473963260650635],
[139.72547912597656,2.131178379058838],
[138.12265014648438,2.140790700912476],
[135.14895629882812,2.2263176441192627],
[132.1783447265625,2.311540603637696],
[129.6648406982422,2.347735643386841],
[127.77751922607422,2.371934652328491],
[125.42125701904295,2.389711618423462],
[122.6475830078125,2.381388664245605],
[118.79502868652344,2.3937017917633057],
[115.48099517822266,2.386643886566162],
[113.63375854492188,2.344970464706421],
[111.51802825927734,2.1352925300598145],
[109.43817138671876,1.6781316995620728],
[107.4599609375,0.9631591439247132],
[105.49199676513672,-0.0606176182627677],
[103.46194458007812,-1.5352991819381714],
[101.62940216064452,-3.3674991130828857],
[100.31979370117188,-5.122528076171875],
[99.37379455566406,-6.740663528442383],
[98.50331115722656,-8.6937837600708],
[97.89576721191406,-10.57181167602539],
[97.48242950439452,-12.24947738647461],
[97.08103942871094,-14.658056259155272],
[96.7312469482422,-18.30776596069336],
[96.59795379638672,-21.885671615600582],
[96.51602935791016,-27.053407669067383],
[96.39704895019533,-33.01542282104492],
[96.255126953125,-37.94596481323242],
[96.1181411743164,-41.86602783203125],
[95.9666748046875,-44.21810531616211],
[95.8126449584961,-46.43275833129883],
[95.6199722290039,-48.52679443359375],
[95.2916030883789,-51.06951904296875],
[94.8449478149414,-53.4742317199707],
[94.23973083496094,-55.94107818603516],
[93.40534210205078,-58.54901885986328],
[92.38838958740234,-61.0804443359375],
[90.99861145019533,-63.90523147583008],
[89.61832427978516,-66.25605010986328],
[88.21282196044922,-68.34786224365234],
[86.140869140625,-71.01036834716797],
[84.316650390625,-73.02442169189453],
[82.33550262451172,-74.93716430664062],
[80.22999572753906,-76.71208190917969],
[78.18778991699219,-78.2186508178711],
[75.29747009277344,-80.04161071777344],
[72.65668487548828,-81.43087005615234],
[70.14089965820312,-82.53673553466797],
[67.70462036132812,-83.4132080078125],
[65.2446517944336,-84.10621643066406],
[62.5006103515625,-84.66207885742188],
[59.2197151184082,-85.05378723144531],
[56.61266326904297,-85.19728088378906],
[54.2256965637207,-85.2314453125],
[51.36027145385742,-85.20275115966797],
[48.72001266479492,-85.178955078125],
[46.70759201049805,-85.1691665649414],
[45.03871154785156,-85.14640808105469],
[41.13240814208984,-84.96925354003906],
[39.75841522216797,-84.65227508544922],
[38.8882064819336,-84.28199005126953],
[37.91038131713867,-83.67018127441406],
[36.91491317749024,-82.78119659423828],
[36.14453125,-81.8133316040039],
[35.44059371948242,-80.57667541503906],
[34.97909927368164,-79.43476104736328],
[34.58819580078125,-78.02921295166016],
[34.3384895324707,-76.5582046508789],
[34.23439407348633,-75.49600982666016],
[34.11192321777344,-73.968505859375],
[34.063819885253906,-71.11015319824219],
[34.19448471069336,-67.71878814697266],
[34.48771286010742,-62.9421272277832],
[34.78739929199219,-57.98802947998047],
[35.02250671386719,-52.33256149291992],
[35.03718566894531,-46.10567855834961],
[34.97438049316406,-39.33833312988281],
[34.89069747924805,-31.2504997253418],
[34.77851104736328,-23.08679962158203],
[34.745948791503906,-15.234813690185549],
[34.76844024658203,-5.997714042663574],
[34.796607971191406,3.372368097305298],
[34.85349655151367,12.08098602294922],
[34.92776107788086,19.257474899291992],
[34.983917236328125,25.8101806640625],
[35.08452606201172,35.10803985595703],
[35.25404357910156,44.0775146484375],
[35.54553985595703,54.04889678955078],
[35.728736877441406,60.99332046508789],
[35.87374496459961,67.37380981445312],
[35.971885681152344,72.41766357421875],
[36.03288650512695,76.1683349609375],
[36.07015609741211,78.65986633300781],
[36.1002082824707,80.90931701660156],
[36.11333084106445,81.98738861083984],
[34.04728317260742,-73.55826568603516],
[33.64603805541992,-70.9837646484375],
[33.21106719970703,-66.73360443115234],
[32.923789978027344,-62.29799270629883],
[32.62804412841797,-55.74805450439453],
[32.350704193115234,-47.40311813354492],
[32.29579162597656,-37.8909912109375],
[32.201324462890625,-27.40454292297364],
[32.03064727783203,-18.713809967041016],
[31.80758285522461,-10.294915199279783],
[31.746238708496094,-2.219249725341797],
[31.74537849426269,5.953425884246826],
[31.713287353515625,13.015708923339844],
[31.72148895263672,20.38733291625977],
[31.765356063842773,26.374813079833984],
[31.873571395874023,33.36288070678711],
[32.140289306640625,41.207557678222656],
[32.44137191772461,48.21905517578125],
[32.79238510131836,57.08679962158203],
[33.113059997558594,64.4524917602539],
[33.320457458496094,71.40209197998047],
[33.49522399902344,79.03541564941406],
[33.75290298461914,87.35708618164062],
[34.06615447998047,94.06790161132812],
[34.54545211791992,102.5271453857422],
[35.11221694946289,111.13170623779295],
[35.584075927734375,118.1079559326172],
[36.14792251586914,126.2633285522461],
[36.734619140625,134.35687255859375],
[37.24488830566406,141.41529846191406],
[37.65108871459961,147.10354614257812],
[37.83170700073242,149.69252014160156],
[38.02007293701172,152.60012817382812],
[38.253299713134766,156.65878295898438],
[38.41510772705078,160.35218811035156],
[38.537109375,164.0099639892578],
[38.61839294433594,167.20286560058594],
[38.6991081237793,170.50511169433594],
[38.79395294189453,173.84124755859375],
[38.99357223510742,177.104736328125],
[39.31197738647461,179.58843994140625],
[39.83974456787109,181.672119140625],
[40.77243041992188,183.77081298828125],
[42.27145004272461,185.88291931152344],
[44.28657150268555,187.7183990478516],
[46.97199249267578,189.2206268310547],
[49.93660354614258,190.1436462402344],
[53.3770637512207,190.64483642578125],
[57.704681396484375,190.87391662597656],
[61.1712532043457,190.82550048828125],
[66.23656463623047,190.68899536132807],
[72.56246185302734,190.5758819580078],
[80.84024047851562,190.5831451416016],
[91.23037719726562,190.5396423339844],
[104.16639709472656,190.09461975097656],
[116.24944305419922,189.07696533203125],
[126.42328643798828,187.32693481445312],
[135.8081512451172,184.92672729492188],
[143.8603973388672,181.97706604003903],
[149.5735626220703,179.23123168945312],
[154.72396850585938,176.1139678955078],
[157.98399353027344,173.7435302734375],
[160.44842529296875,171.74447631835938],
[164.88052368164062,167.7399139404297],
[169.9404296875,162.60092163085938],
[175.8842315673828,155.5475616455078],
[181.18118286132807,147.92559814453125],
[185.8275756835937,139.6408233642578],
[188.91200256347656,132.72006225585938],
[191.1507568359375,126.46219635009766],
[192.8667755126953,120.40333557128906],
[194.43869018554688,112.80892944335938],
[195.37515258789065,105.45186614990234],
[195.8168334960937,97.8355484008789],
[195.9904022216797,90.19163513183594],
[196.01321411132807,81.9579849243164],
[196.021240234375,74.2060317993164],
[196.05520629882807,65.6724853515625],
[196.0736846923828,57.56343460083008],
[196.017318725586,49.98523712158203],
[195.9240264892578,43.10099411010742],
[195.95350646972656,36.40924835205078],
[196.0984649658203,30.72312355041504],
[196.31515502929688,25.575424194335938],
[196.41835021972656,23.000438690185547],
[196.4713287353516,21.59025764465332],
[196.5234375,20.134899139404297],
[197.0507354736328,-1.944788932800293],
[197.11407470703125,-8.347302436828613],
[197.13717651367188,-16.832550048828125],
[197.0852508544922,-25.86345863342285],
[196.87106323242188,-38.63191604614258],
[196.71925354003903,-47.13848876953125],
[196.7115173339844,-56.7075424194336],
[196.5912475585937,-65.72047424316406],
[196.10723876953125,-76.9034194946289],
[195.75282287597656,-85.33101654052734],
[195.11428833007807,-93.70877075195312],
[194.11778259277344,-101.2830581665039],
[192.62237548828125,-108.99079895019533],
[190.559310913086,-116.64231872558594],
[187.93289184570312,-124.21356964111328],
[185.2334899902344,-130.67010498046875],
[181.4510040283203,-138.2418212890625],
[177.6595001220703,-144.6718292236328],
[173.72596740722656,-150.4667205810547],
[169.6521453857422,-155.70297241210938],
[164.79574584960938,-161.11672973632812],
[160.4270782470703,-165.35459899902344],
[153.41522216796875,-171.11581420898438],
[146.9918670654297,-175.3751678466797],
[140.22293090820312,-178.99610900878906],
[132.70370483398438,-182.1622467041016],
[125.60531616210938,-184.5682373046875],
[117.79518127441406,-186.56231689453125],
[111.41790008544922,-187.67616271972656],
[102.92591857910156,-188.46864318847656],
[96.63483428955078,-188.5800018310547],
[90.26766204833984,-188.44412231445312],
[82.9918441772461,-188.20123291015625],
[75.7280044555664,-188.07632446289065],
[66.7927017211914,-188.010986328125],
[59.37589645385742,-187.95172119140625],
[48.58601760864258,-187.91070556640625],
[40.6755256652832,-187.84901428222656],
[31.82113265991211,-187.75054931640625],
[20.20988273620605,-187.72120666503903],
[9.173605918884276,-187.82530212402344],
[-1.4953649044036863,-187.94924926757807],
[-12.337183952331545,-188.0320587158203],
[-22.450300216674805,-188.01284790039065],
[-32.21338653564453,-187.9986114501953],
[-42.70310974121094,-188.0423583984375],
[-55.12437057495117,-188.0032958984375],
[-66.08451080322266,-187.96484375],
[-77.00337982177734,-187.9379119873047],
[-88.68544006347656,-187.93798828125],
[-101.66680145263672,-188.0426177978516],
[-114.05787658691406,-188.15760803222656],
[-127.2555923461914,-188.19332885742188],
[-137.8949737548828,-188.1215362548828],
[-148.6754150390625,-187.7562713623047],
[-158.61593627929688,-186.7716827392578],
[-167.47409057617188,-184.9583740234375],
[-175.09963989257812,-182.5551147460937],
[-181.03466796875,-180.12571716308594],
[-186.2311248779297,-177.5801544189453],
[-192.4176483154297,-173.9921875],
[-196.9512481689453,-170.92982482910156],
[-201.1309967041016,-167.73590087890625],
[-204.66148376464844,-164.72122192382812],
[-207.6748962402344,-161.88124084472656],
[-210.59849548339844,-158.84938049316406],
[-213.4688873291016,-155.56698608398438],
[-216.06704711914065,-152.2790985107422],
[-218.94577026367188,-148.20790100097656],
[-221.84622192382807,-143.54013061523438],
[-224.39859008789065,-138.81089782714844],
[-226.65792846679688,-133.9298553466797],
[-228.67149353027344,-128.7329559326172],
[-230.02381896972656,-124.51998901367188],
[-231.02052307128903,-120.7984619140625],
[-231.94712829589844,-116.51243591308594],
[-232.66259765625,-112.13958740234376],
[-233.2683563232422,-106.58002471923828],
[-233.5730743408203,-100.89299774169922],
[-233.5719146728516,-94.11439514160156],
[-233.35166931152344,-86.9898910522461],
[-233.0714569091797,-79.90906524658203],
[-232.8571014404297,-70.59233856201172],
[-232.68443298339844,-60.32171249389648],
[-232.53677368164065,-49.12055206298828],
[-232.47010803222656,-36.83917999267578],
[-232.45733642578125,-23.72057342529297],
[-232.46788024902344,-11.532715797424316],
[-232.4912567138672,-1.7232680320739746],
[-232.52932739257807,8.280641555786133],
[-232.57850646972656,17.709550857543945],
[-232.65020751953125,28.46160316467285],
[-232.7327117919922,38.21286392211914],
[-232.82373046875,45.778446197509766],
[-232.96592712402344,54.52043151855469],
[-233.10369873046875,61.48518753051758],
[-233.2041473388672,67.13981628417969],
[-233.2577667236328,70.54219055175781],
[-233.31333923339844,73.60137176513672],
[-233.3453826904297,75.18302917480469]]#coordinates of the points we have to go through

#taken from internet, should be correct
def quaternion_to_euler_angle_vectorized1(w, x, y, z):
    ysqr = y * y

    t0 = +2.0 * (w * x + y * z)
    t1 = +1.0 - 2.0 * (x * x + ysqr)
    X = np.degrees(np.arctan2(t0, t1))

    t2 = +2.0 * (w * y - z * x)
    t2 = np.where(t2>+1.0,+1.0,t2)
    #t2 = +1.0 if t2 > +1.0 else t2a
    #t2 = -1.0 if t2 < -1.0 else t2
    Y = np.degrees(np.arcsin(t2))

    t3 = +2.0 * (w * z + x * y)
    t4 = +1.0 - 2.0 * (ysqr + z * z)
    Z = np.degrees(np.arctan2(t3, t4))

    return X, Y, Z 

def odometry_direction(start,end, heading): #define an angle that represents the direction to the next gpx point
    global target, prev_angle
    dist_threshold=2.7#max distance to check the target  [m]
    reached=False
    x_c=start[0] #current latitude in radians
    x_t=end[0] #target latitude in radians
    y_c=start[1] #current lonwdagitude in radians
    y_t=end[1] #target longitude in radians
    d_x=x_t-x_c
    d_y=y_t-y_c

    current_dist=np.sqrt(d_x**2+d_y**2) #dist in m

    if(current_dist< dist_threshold) :
        reached=True

    direction_angle = math.degrees(math.atan2(d_y,d_x))  #angle in radians
    heading_angle=heading #for the non-transform3d function

    steer_angle = heading_angle-direction_angle
    
    if steer_angle < -180:
        steer_angle = 360-(steer_angle) 
    elif steer_angle > 180:
        steer_angle = steer_angle-360

    if steer_angle > 180:
        steer_angle = 180
    elif steer_angle < -180:
        steer_angle = -180
        
    print(heading_angle)
    print(direction_angle)
    print(steer_angle)
    steer_angle=steer_angle*1.5
    prev_angle = steer_angle
    return steer_angle, reached 


def callback_odo(odo):
    global target, prev_angle, xy_list
    #if not computed :
    #    return
    
    """
    quaternion = (
    odo.pose.pose.orientation.w,
    odo.pose.pose.orientation.x,
    odo.pose.pose.orientation.y,
    odo.pose.pose.orientation.z
    )
    """
    w = odo.pose.pose.orientation.w
    x = odo.pose.pose.orientation.x
    y = odo.pose.pose.orientation.y
    z = odo.pose.pose.orientation.z
    
    pitch,roll,yaw=quaternion_to_euler_angle_vectorized1(w,x,y,z)
    yaw=yaw
   
    steer_angle, reached=odometry_direction([odo.pose.pose.position.x, odo.pose.pose.position.y],xy_list[target],yaw)
    if(reached):
        target+=1
        if(target==len(xy_list)):
            target=0
            #print(f"REACHED {waypoint_counter+1}")
    steer_angle=steer_angle/180
    
    steer_angle=np.clip(steer_angle,-1,1)
    print(waypoint_counter)
    print(xy_list[target])
    if(np.abs(steer_angle)<0.25):
        thr_pub.publish(Float64(0.35))#primitive throttle control
    else:
        thr_pub.publish(Float64(0.20))#
    steer_pub.publish(Float64(steer_angle)) #this message is sent to kalman filter

    
    pass

def main_loop():
    #setup subscribers
    global thr_pub
    odo_sub=rospy.Subscriber('/carla/ego_vehicle/odometry', Odometry, callback_odo)
    #score_sub=rospy.Subscriber('/score',Score, callback_score)#subscribe to the score topic in order to get the distance to the 15 waypoints
    rospy.spin()

if __name__ == '__main__':
    #start node
    computed=False #compute the distances only one time
    done=False
    rospy.init_node('shell_simulation_node', anonymous=True)
    r=rospy.Rate(10)
    rp=RosPack()
    #setup variables
    target = 0#keeps track of the carla waypoints 
    prev_angle = 0#previuos angle 
    #computed_points=np.array([1,20,36,35,26,14,25,6,5,11,13,28,31,16,29,40],dtype=int)#the 15 waypoints we have to go through in no specific order
    #computed_points=[1, 3, 5, 10, 11, 12, 14, 15, 17, 18, 19, 22, 24, 26, 35]
    #computed_path=[]#15 points we want to go through 
    waypoint_counter=0#keeps track of what waypoint_counter we reached

    #print(path)
    #setup publishers
    gear_pub=rospy.Publisher("/gear_command",String, queue_size=1)#publisher for gear NB don't touch it again after putting the gear as forward
    steer_pub=rospy.Publisher("/steering_command",Float64, queue_size=1)#publisher for steering command
    thr_pub=rospy.Publisher("/throttle_command",Float64, queue_size=1)#publisher for throttle command
    brake_pub=rospy.Publisher("/brake_command",Float64, queue_size=1)#publisher for brake command
    done=True
    try:   
     main_loop()  
    except rospy.ROSInterruptException: 
     pass
